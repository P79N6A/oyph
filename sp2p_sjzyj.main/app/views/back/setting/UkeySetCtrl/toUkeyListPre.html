#{extends 'common/back/settingMain.html' /}
	#{set title:'设置 | 加密狗设置' /}
	#{set smallclass:5 /}
	#{set crumbs:'设置>加密狗设置'/}
<div class="back-main">
	<!-- 头部筛选条件 -->
	<div class="back-usertop">
		<div class="left back-usermenu">
			<a href="javascript:void(0)" class="selected">加密锁列表</a>
		</div>
		
		<!-- 右侧功能按钮 -->
		<div class="right back-rightbtns">
			<a href="@{back.setting.UkeySetCtrl.toAddUkeyPre()}"><i class="iconfont">&#xe60f;</i>添加</a>
		</div>
	</div>
	
	<!-- 搜索条件，默认隐藏 -->
	<div class="back-search-option">
		<form action="@{back.setting.UkeySetCtrl.toUkeyListPre()}" method="GET" id="shotUkey">
			<input type="hidden" id="currPage" name="currPage" value="${page?.currPage}"/>
	  		<input type="hidden" id="pageSize" name="pageSize" value="${page?.pageSize}"/>
			<input type="submit" class="bgbtn" value="搜索" />
		</form>
	</div>
	<div class="back-cont">
		<div class="back-box">
			<table width="100%" class="back-table table-fixed">
				<tr height="40">
					<th width="70" class="align-left">编号</th>
					<th>姓名</th>
					<th>加密锁ID</th>
					<th>密钥</th>
					<th width="120">状态</th>
					<th width="120">操作</th>
				</tr>
			
				#{if page?.page}
					#{list items:page.page,as:'ukey'}
						
						<tr height="40">
						<td>${ukey?.ukey_sn}</td>
						<td>${ukey?.ukey_user}</td>
						<td>${ukey?.ukey_id}</td>
						<td>${ukey?.ukey_ckey}</td>
						<td>
							#{if ukey?.ukey_stat == 0}
								未设置
							#{/if}
							#{if ukey?.ukey_stat == 1}
								正常
							#{/if}
							#{if ukey?.ukey_stat == 2}
							<font style="color: red;">已挂失</font>
							#{/if}
						</td>
						
						<td class="back-handle">
							#{rightMng rightId:804006}
							#{if ukey?.ukey_stat == 2}
								<a href="javascript:void(0);" data-title="解锁" class="iconfont" onclick="lockOrUnlock('${ukey?.id}',1)">&#xe63c;</a>
							#{/if}
							#{if ukey?.ukey_stat == 1}
								<a href="javascript:void(0);" data-title="锁定" class="iconfont" onclick="lockOrUnlock('${ukey?.id}',2)">&#xe627;</a>
							#{/if}
							#{/rightMng}
						
							#{rightMng rightId:804006}
							<a href="@{back.setting.UkeySetCtrl.toUkeySetPre(ukey?.ukey_sn)}" data-title="编辑" class="iconfont">&#xe602;</a>
							#{/rightMng}
						</td>
					</tr>
	
					#{/list}
					
					<tr height="40">
						<td colspan="6" class="back-lasttd">
							#{backPageTag page:page,showPage:'showPage' /}
						</td>
					</tr>
				#{/if}
				#{else}
					暂无记录
					<tr height="58">
						<td colspan="6" class="back-nodata"><i class="iconfont">&#xe613;</i>暂无记录</td>
					</tr>
				#{/else}
				
			</table>
		</div>
	</div>
</div>

<script type="text/javascript">

	//分页方法
	function showPage(currPage, pageSize) {
		$("#shotUkey input[name='currPage']").val(currPage);
		$("#shotUkey input[name='pageSize']").val(pageSize);
	
		$("#shotUkey").submit();
	}
	
	//解锁/锁定用户
	function lockOrUnlock(ukeyId, stat) {
			$.ajax({
				url : "@{back.setting.UkeySetCtrl.updateUkeyStatus()}",
				type : "POST",
				data : {
					"ukeyId" : ukeyId,
					"stat" : stat
				},
				dataType : "json",
				success : function(result) {
					var flag = interceptorCheck(result);
					if (!flag) {
						return;
					}

					if (result.code < 1) {
						alert(result.msg);
					} else {
						document.location.reload();
					}
				}
			});
	}
</script>