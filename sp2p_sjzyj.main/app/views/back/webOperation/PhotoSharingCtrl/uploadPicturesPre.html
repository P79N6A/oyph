#{extends 'common/back/webOperationMain.html' /}
	#{set title:'运维 | 优选照片上传' /}
	#{set smallclass:14 /}
	#{set crumbs:'运维 >优选照片上传' /}
	
<div class="back-main">
	<!-- 头部筛选条件 -->

	<!-- 主题照片设置 -->
	<div class="back-cont">
	
		<!-- 红包设置 -->
		<div class="back-infor">
			<form action="" method="POST" id="recharge">
				<h2 class="back-infor-head"><span class="left">主题照片设置</span>
				</h2>
				
				<ul id="tableList">
					#{if selectThemeList}
							#{list items:selectThemeList,as:'selectTheme'}
							<li>
							  <img src="${selectTheme?.image_url}"  height="100" width="100" />
							  <p style="text-align: center;margin-top: 10px;"><input type="button"  onclick="deletePhoto(${selectTheme?.id})" value="删除"></p>
							</li>
							#{/list}			
					#{/if}
					#{else}
						<li>
							<p style="width:720px;padding:20px 0; text-align: center;" colspan="5" class="back-nodata"><i class="iconfont">&#xe613;</i>暂无设置</p>
						</li>
					#{/else}
				</ul>	
					
			</form>	
		
		<form action="@{back.webOperation.PhotoSharingCtrl.addSelectPhotoss()}" method="POST" id="add_cons" style="padding-bottom: 30px;">
		#{authenticityToken /}
		<input type="hidden" name="uuidRepeat" value="${flash?.submitUuid}">
		<div class="back-cont" >
				<ul style="margin: auto; width: 600px;" class="back-infor-set">
					<li>
						<span class="lileft">优选照片</span>
						<div class="liright">
						<input type="hidden" name="themeId" value="${themeId}" >
							<span class="back-imgarea imgrequired">
								<img src="${flash?.image_url} ? ${flash?.image_url} : '/public/back/images/noimg.jpg'" onerror="this.src='/public/back/images/noimg.jpg'" class="backupimg" height="100" width="100" id="image" name="image" alt="" title=""/>
								<input type="hidden" id="imageUrl" name="consultant.image_url" value="${flash?.image_url}">
							</span>
							<span class="back-upimg">
								<label class="back-upbtn">
									<input type="file" class="upload_file" value="" name="imgFile" accept=".jpg,.jpeg,.png,.gif" id="imgFile" onchange="uploadImg()"/>
									<i class="iconfont">&#xe608;</i>本地上传
								</label>
									
								<!-- 图片要求 -->
								<p class="back-imginfor-note">最大比例1200*800&nbsp;&nbsp;jgp/png&nbsp;&nbsp;大小不超过5M</p>
								<div class="back-upload-imginfor">
										<span id="resolutionshow">${flash?.image_resolution}</span>&nbsp;<span id="formatshow">${flash?.image_format}</span>&nbsp;<span id="sizeshow">${flash?.image_size}</span>
								</div>
									
								<!-- 图片参数，用于保存 -->
								<input type="hidden" id="imageResolution" name="consultant.image_resolution" value="${flash?.image_resolution}">
								<input type="hidden" id="imageFormat" name="consultant.image_format" value="${flash?.image_format}">
								<input type="hidden" id="imageSize" name="consultant.image_size" value="${flash?.image_size}">	
							</span>
						</div>
					</li>

					<li>
						<span class="lileft">排序时间轴</span>
						<div class="liright">
							<input type="text" autofocus="autofocus" minlength="1" maxlength="20" id="orderTime" name="consultant.order_times" class="width01 iffocus required" value="${flash?.orderTime}" />
							<span class="back-text-limit">例：     ( 8:00-9:00 )</span>
						</div>
					</li>
					<li>
						<span class="lileft">排序序号</span>
						<div class="liright">
							<input type="text" autofocus="autofocus" minlength="1" maxlength="20" id="order" name="order" class="width01 iffocus required" value="${flash?.order}" />
						</div>
					</li>
				</ul>
			</div>
			<p class="back-audit-btns textwidth">
				#{rightMng rightId:214003}
					<input type="submit" id="pageSave" value="保存" class="bgbtn">
					<input value="生成" class="bgbtn" onclick="javascript:window.location.href='@{front.ActivityCtrl.SharingPhotoIndexPre(themeId)}'">
				#{/rightMng}
				
			</p>
				
		</form>	
		<!-- 删除设置 -->
		<form action="@{back.webOperation.PhotoSharingCtrl.delPhoto()}" id="shakeSetForm" method="post">
			<input id="photoId" name="photoId" type="hidden" />
			<input type="hidden" name="themeId" value="${themeId}" id="themeId">
			
		</form>
		</div>
	</div>
</div>

<!-- 页面js -->
<script type="text/javascript">
require(["back"],function(back){
	require(["datatime","ajaxfileupload"]);
	
	//添加广告图片
	$("#add_cons").validate({
		errorPlacement: function(error, element) {
			error.addClass('back-notice').insertAfter(element);
		},
		rules:{
			"consultant.order":{
				required:true,
				rangelength:[1,20]
			},
			"consultant.image_url":{
				required:true
			},
			"consultant.image_resolution":{
				required:true
			},
			"consultant.image_size":{
				required:true
			},
			"consultant.image_format":{
				required:true
			},
			"consultant.order_time":{
				required:true
			}
		},
		messages:{
			"consultant.order":{
				required:"标题1-20个字符"
			},
			"consultant.image_url":{
				required:"上传主题照片不能为空"
			},
			"consultant.image_resolution":{
				required:"上传主题照片不能为空"
			},
			"consultant.image_size":{
				required:"上传主题照片不能为空"
			},
			"consultant.image_format":{
				required:"上传主题照片不能为空"
			},
			"orderTime":{
				required:"排序时间不能为空"
			}
		}
	});

});
	
function uploadImg(){
	var fileId = "imgFile";
	var file = $("#" + fileId).val();
	var pos = file.lastIndexOf("\\");
	var fileName = file.substring(pos + 1);
	
	$.ajaxFileUpload({
		url : '@{back.webOperation.PhotoSharingCtrl.uploadConsultantImage()}',
		secureuri : false,
		fileElementId : fileId,
		data:{
			"fileName":fileName
		},
		dataType : 'json',
		success : function(result) {
			if(result.code == 1){
				var data = result.obj;
				$("#image").attr("src", data.staticFileName);
				$("#imageSize").val(data.size+"kb");
				$("#imageFormat").val(data.fileSuffix);
				$("#imageResolution").val(data.imageResolution);
				$("#resolutionshow").html(data.imageResolution);
				$("#formatshow").html(data.fileSuffix);
				$("#sizeshow").html(data.size+"kb");
				$("#imageUrl").val(data.staticFileName);
				$("#cropImgLabel").show();
			} else {
				alert(result.msg);
			}
		}
	})
}

</script>	


<script type="text/javascript">
	//删除设置
	
	function deletePhoto(shakeSetId) {

		$("#photoId").val(shakeSetId); 
		$("#shakeSetForm").submit();
	}


</script>

