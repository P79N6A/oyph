#{extends 'common/back/webOperationMain.html' /}
#{set title:'运维 | 借款合同管理 ' /}
#{set smallclass:13 /}
#{set crumbs:'运维> 借款合同管理' /}
<div class="back-main">
	<!-- 左侧菜单 -->
	<form action="@{back.webOperation.UpdateContractCtrl.editContract()}" method="POST" id="editInfor">
		<div class="back-cont">
			<div class="back-infor">
				<h2 class="back-infor-head">内容</h2>
				<ul class="back-infor-set">
					<li>
						<span class="lileft">标题</span>
						<div class="liright">
							<input type="text" minlength="1" maxlength="20" id="title" name="pacts.name" class="width05 required iffocus" value="${pacts?.name}" />
							<span class="back-text-limit">1~20个字符</span>
						</div>
					</li>
					<li>
						<span class="lileft">内容</span>
						<div class="liright">
							<textarea id="inforTextarea" name="pacts.content" class="back-textarea" >${pacts?.content}</textarea>
						</div>
					</li>
					<li>
						<span class="lileft">发布时间</span>
						<div class="liright">
							<input type="text" class="easyui-datetimebox" id="time" name="time" value="${pacts?.time?.format(common.constants.Constants.DATE_PLUGIN)}" />
						</div>
					</li>
				</ul>
			</div>
			<p class="back-audit-btns">
				#{rightMng rightId:2018002}
					<input type="submit" id="pageSave" value="保存" class="bgbtn">
				#{/rightMng}
				<input type="button" value="取消" class="bdbtn">
			</p>
		</div>
	</form>
</div>


<!-- 图片裁切弹窗 begin -->
<div class="dialog crop-dialog">
	<div class="dialog-bg"></div>
	<div class="dialog-cont">
		<div class="dialog-head">
			<span class="left">图片裁剪</span>
			<a href="javascript:void(0);" class="dialog-close hover-green" id="dialogClose">×</a>
		</div>
		<div class="crop-box">
			<div class="clearfix">
				<div class="crop-img">
					<img src="" id="cropimg" />
				</div>
				<div class="crop-right">
					<div class="crop-preview">
						<div class="preview-container">
							<img src="" />
						</div>
					</div>
					<ul class="crop-handle">
						<li><label class=""><input type="radio" id="maxSize" name="cropsize" />最大尺寸</label></li>
						<li><label class=""><input type="radio" id="standardSize" name="cropsize" />标准尺寸</label></li>
					</ul>
				</div>
			</div>
			<p class="back-audit-btns">
				<input type="button" value="保存" class="bgbtn" onclick="saveCropImg(cropImgSuccess)">
				<input type="button" value="取消" class="bdbtn dialog-console">
			</p>
			<input type="hidden" id="x"/>
			<input type="hidden" id="y"/>
			<input type="hidden" id="w"/>
			<input type="hidden" id="h"/>
			<input type="hidden" id="imageType" /><!-- 图片格式 -->
		</div>
	</div>
</div>
<!-- 图片裁切弹窗 end -->


<script type="text/javascript">

var img_width = 820;
var img_height = 377;

require(["back"],function(back){
	require(["ajaxfileupload","datatime","cutImg"]);
	
	var infor_content = null;
	require(["editor"],function(editor){
		infor_content = editor('#inforTextarea');
	}); 
	
	//当前栏目要求的尺寸 
	setImgSize("${information?.column_key}");

	//栏目切换时，重新设置要求尺寸 
	$('#columnKey').change(function(){
		var val = $("#columnKey").val();
		setImgSize(val);
	});
	
	
	$(function(){
		$("#imageUrl").val($("#image").attr("src"));
	});
	
	//编辑资讯内容 
	$("#editInfor").validate({
		errorPlacement: function(error, element) {
			error.addClass('back-notice').insertAfter(element);
		},
		rules:{
			"pacts.name":{
				required:true,
				rangelength:[1,20]
			},
			"time":{
				required:true
			}			
		},
		messages:{
			"pacts.name":{
				required:"标题不能为空",
				rangelength:"标题1-20个字符"
			},
			"time":{
				required:"发布时间不能为空"
			}
		},
		submitHandler:function(form){
			console.info(infor_content);
			if(!infor_content.isEmpty()){
				form.submit();
			}
		}
	});
		
});

// 图片要求尺寸 
function setImgSize (barMenu) {
	imgLimit = $("#back_imginfor_note");
	switch(barMenu){
		case "home_profile": {
			img_width = 1920;
			img_height = 400;
			imgLimit.text(img_width+"*"+img_height+"，jpg/png，大小不超过2M");
			break;
		}
		case "home_joinus":  {
			img_width = 1920;
			img_height = 400;
			imgLimit.text(img_width+"*"+img_height+"，jpg/png，大小不超过2M");
			break;
		}
		default: {
			img_width = 820;
			img_height = 377;
			imgLimit.text(img_width+"*"+img_height+"，jpg/png，大小不超过2M");
			break;
		}	
	}
}

// 图片裁剪成功，回调函数 
var cropImgSuccess = function(data) {
	$("#image").attr("src", data.staticFileName);
	$("#imageUrl").val(data.staticFileName);
	$("#imageSize").val(data.size + "kb");
	$("#sizeshow").html(data.size + "kb");
	$("#imageResolution").val(data.width + "*" + data.height);
	$("#resolutionshow").html(data.width + "*" + data.height);
}


//图片上传 
function upload(){
	var fileId = "imgFile";
	var file = $("#" + fileId).val();
	var pos = file.lastIndexOf("\\");
	var fileName = file.substring(pos + 1);
	
	$.ajaxFileUpload({
		url : '@{back.webOperation.InformationMngCtrl.uploadInformationImage()}',
		secureuri : false,
		fileElementId : fileId,
		data:{
			"fileName":fileName
		},
		dataType : 'json',
		success : function(result) {
			if(result.code == 1){
				var data = result.obj;
				$("#image").attr("src", data.staticFileName);
				$("#imageUrl").val(data.staticFileName);
				
				$("#imageSize").val(data.size+"kb");
				$("#sizeshow").html(data.size+"kb");
				
				$("#imageFormat").val(data.fileSuffix);
				$("#formatshow").html(data.fileSuffix);
				
				$("#imageResolution").val(data.imageResolution);
				$("#resolutionshow").html(data.imageResolution);
				
				$("#cropImgLabel").show();
			} else {
				alert(result.msg);
			}
		}
	})
}
</script>