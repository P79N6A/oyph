#{extends 'common/back/webOperationMain.html' /}
    #{set title:'运维 | 投票活动管理 | 添加投票活动' /}
    #{set smallclass:10 /}
    #{set crumbs:'运维>投票活动管理>添加投票活动' /}
    
<div class="back-main">
    <!-- 头部筛选条件 -->
    <div class="back-usertop">
        <b class="left font14">添加内容</b>
        <!-- 右侧功能按钮 -->
        <div class="right back-rightbtns">
            <a href="javascript:backAndRefresh('@{back.webOperation.VoteMngCtrl.showVotesPre}');"><i class="iconfont">&#xe60b;</i>返回</a>
        </div>
    </div>
    <!-- 左侧菜单 -->
    <form action="@{back.webOperation.VoteMngCtrl.addVote()}" method="POST" id="addVote">
        #{authenticityToken /}
        <input type="hidden" name="uuidRepeat" value="${flash?.submitUuid}">
        
        <div class="back-cont">
            <div class="back-infor">
                <h2 class="back-infor-head">内容</h2>
                <ul class="back-infor-set">
                    <li>
                        <span class="lileft">活动主题</span>
                        <div class="liright">
                            <input type="text" minlength="1" id="title" name="vote.title" maxlength="20" class="width05 required iffocus" value="${vote?.title}"/>
                            <span class="back-text-limit">1~20个字符</span>
                        </div>
                    </li>
                    <li>
                        <span class="lileft">活动介绍</span>
                        <div class="liright">
                            <textarea class="back-textarea" id="inforTextarea" name="vote.activity_introduction">${vote?.activity_introduction}</textarea>
                        </div>
                    </li>
                    <li>
                        <span class="lileft">活动图片要求</span>
                        <div class="liright">
                            <input type="text" maxlength="30" class="width05 iffocus" id="keywords" name="vote.pic_need" value="${vote?.pic_need}" />
                            <p class="back-textnote">0~30个字符，填写活动客户上传图片要求</p>
                        </div>
                    </li>
                    <li>
                        <span class="lileft">顶部图片</span>
                        <div class="liright">
                            <span class="back-imgarea imgrequired">
                                <!-- 没有上传图片 -->
                                <img src="${vote?.img_ur} ? ${vote?.img_ur} : '/public/back/images/noimg.jpg'" onerror="this.src='/public/back/images/noimg.jpg'" class="backupimg" height="100" width="200" id='image' name="image" alt="" title=""/>
                                <input type="hidden" id="imageUrl" name="vote.img_url" value="${vote?.img_url}">
                            </span>
                            <span class="back-upimg">
                                <label class="back-upbtn">
                                    <input type="file" class="upload_file" value="" accept=".jpg,.jpeg,.png,.gif" name="imgFile" id="imgFile" onchange="upload()"/>
                                    <i class="iconfont">&#xe608;</i>本地上传
                                </label>
                                <p class="back-imginfor-note">1920*400&nbsp;&nbsp;jpg/png&nbsp;&nbsp;大小不超过2M</p>
                                
                            </span>
                        </div>
                    </li>
                    <li>
                        <span class="lileft">背景图片</span>
                        <div class="liright">
                            <span class="back-imgarea imgrequired">
                                <!-- 没有上传图片 -->
                                <img src="${vote?.background_url} ? ${vote?.background_url} : '/public/back/images/noimg.jpg'" onerror="this.src='/public/back/images/noimg.jpg'" class="backupimg" height="100" width="200" id='imageBack' name="image" alt="" title=""/>
                                <input type="hidden" id="imageBackUrl" name="vote.background_url" value="${vote?.background_url}">
                            </span>
                            <span class="back-upimg">
                                <label class="back-upbtn">
                                    <input type="file" class="upload_file" value="" accept=".jpg,.jpeg,.png,.gif" name="imgFile" id="imgBackFile" onchange="uploadBack()"/>
                                    <i class="iconfont">&#xe608;</i>本地上传
                                </label>
                                <p class="back-imginfor-note">1920*400&nbsp;&nbsp;jpg/png&nbsp;&nbsp;大小不超过2M</p>
                                
                            </span>
                        </div>
                    </li>
                    <li>
                        <span class="lileft">开始时间</span>
                        <div class="liright">
                            <input type="text" class="easyui-datetimebox" id="beginTime"  name="beginTime" value="${vote?.begin_time}"/>
                        </div>
                    </li>
                    <li>
                        <span class="lileft">结束时间</span>
                        <div class="liright">
                            <input type="text" class="easyui-datetimebox" id="endTime"  name="endTime" value="${vote?.end_time}"/>
                        </div>
                    </li>
                    <li>
                        <span class="lileft">每人每天投票上限</span>
                        <div class="liright">
                            <input type="text" id="voteNum" name="vote.vote_num" class="iffocus required" style="width: 30px;" onblur="checkNum()" value="${vote?.vote_num}" />
                            <span>票</span><span id="voteNumError" class="back-notice"></span>
                            <p class="back-textnote">上限必须是正整数</p>
                        </div>
                    </li>
                    <li><span class="lileft">奖品设置</span>
                        <div class="liright">
                            <input type="text" name="lowNum" class="iffocus" style="width: 30px;"/>名 ---
                            <input type="text" name="uperNum" class="iffocus" style="width: 30px;"/>名&nbsp;&nbsp;&nbsp;&nbsp;
                            <span>奖品为：</span><input type="text" name="jiangPin" class="width01 iffocus"/>
                            <span id="lowNumError1" class="back-notice"></span>
                            <p class="back-textnote">前两项必须是整数,-1表示不限制，如-1,5表示前五名</p>
                        </div>
                    </li>
                    <li>
                        <span class="lileft"></span>
                        <div class="liright">
                            <input type="text" name="lowNum" class="width01 iffocus" style="width: 30px;"/>名 ---
                            <input type="text" name="uperNum" class="width01 iffocus" style="width: 30px;"/>名&nbsp;&nbsp;&nbsp;&nbsp;
                            <span>奖品为：</span><input type="text" name="jiangPin" class="width01 iffocus"/>
                            <span id="lowNumError2" class="back-notice"></span>
                            <p class="back-textnote">前两项必须是整数,-1表示不限制，如50,-1表示50名以后</p>
                        </div>
                    </li>
                    <li>
                        <span class="lileft"></span>
                        <div class="liright">
                            <input type="text" name="lowNum" class="iffocus" style="width: 30px;"/>名 ---
                            <input type="text" name="uperNum" class="iffocus" style="width: 30px;"/>名&nbsp;&nbsp;&nbsp;&nbsp;
                            <span>奖品为：</span><input type="text" name="jiangPin" class="width01 iffocus"/>
                            <span id="lowNumError3" class="back-notice"></span>
                            <p class="back-textnote">前两项必须是整数,-1表示不限制，如-1,-1表示所有</p>
                        </div>
                    </li>
                    <li>
                        <span class="lileft"></span>
                        <div class="liright">
                            <input type="text" name="lowNum" class="iffocus" style="width: 30px;"/>名 ---
                            <input type="text" name="uperNum" class="iffocus" style="width: 30px;"/>名&nbsp;&nbsp;&nbsp;&nbsp;
                            <span>奖品为：</span><input type="text" name="jiangPin" class="width01 iffocus"/>
                            <span id="lowNumError3" class="back-notice"></span>
                            <p class="back-textnote">前两项必须是整数,-1表示不限制，如-1,-1表示所有</p>
                        </div>
                    </li>
                    <li>
                        <span class="lileft"></span>
                        <div class="liright">
                            <input type="text" name="lowNum" class="iffocus" style="width: 30px;"/>名 ---
                            <input type="text" name="uperNum" class="iffocus" style="width: 30px;"/>名&nbsp;&nbsp;&nbsp;&nbsp;
                            <span>奖品为：</span><input type="text" name="jiangPin" class="width01 iffocus"/>
                            <span id="lowNumError3" class="back-notice"></span>
                            <p class="back-textnote">前两项必须是整数,-1表示不限制，如-1,-1表示所有</p>
                        </div>
                    </li>
                </ul>
            </div>
            <p class="back-audit-btns">
                #{rightMng rightId:211001} 
                    <input type="submit" id="pageSave" value="保存" class="bgbtn" onsubmit="return checkNum();">
                #{/rightMng}
                <input type="button" value="取消" onclick="backAndRefresh('@{back.webOperation.VoteMngCtrl.showVotesPre}');" class="bdbtn">
            </p>
        </div>
    </form>
</div>


<script type="text/javascript">

var img_width = 820;
var img_height = 377;

require(["back"],function(back){
    require(["ajaxfileupload","datatime","cutImg"]);
    var infor_content = null;
    require(["editor"],function(editor){
        infor_content = editor('#inforTextarea');
    });
    
    //是否显示默认图
    var picFlag=true;
    $("#columnKey").change(function(){
        var val = $("#columnKey").val();
        setImgSize(val);    
    });
    
    //添加资讯内容
    $("#addVote").validate({
        errorPlacement: function(error, element) {
            error.addClass('back-notice').insertAfter(element);
        },
        rules:{
            "vote.title":{
                required:true,
                rangelength:[1,20]
            },
            "vote.pic_need":{
                rangelength:[0,30]
            },
            "showTime":{
                required:true
            },
            "orderTime":{
                required:true
            },
            "vote.vote_num":{
                required:true
            }
            
        },
        messages:{
            "vote.title":{
                required:"活动主题不能为空",
                rangelength:"活动主题1-20个字符"
            },
            "vote.pic_need":{
                rangelength:"参与图片要求只能输入0到30个字符"
            },
            "vote.begin_time":{
                required:"活动开始时间不能为空"
            },
            "vote.end_time":{
                required:"活动结束时间不能为空"
            },
            "information.source_from":{
                required:"投票数上限必须为正整数"
            }
        },
        submitHandler:function(form){
            console.info(infor_content);
            if(!infor_content.isEmpty()){
                form.submit();
            }
        }
    });
});
    
function uploadBack(){
	var fileId = "imgBackFile";
    var file = $("#" + fileId).val();
    var pos = file.lastIndexOf("\\");
    var fileName = file.substring(pos + 1);
    
    $.ajaxFileUpload({
        url : '@{back.webOperation.InformationMngCtrl.uploadInformationImage()}',
        secureuri : false,
        fileElementId : fileId,
        data:{
            "fileName":fileName
        },
        dataType : 'json',
        success : function(result) {
            if(result.code == 1){
                var data = result.obj;
                $("#imageBack").attr("src", data.staticFileName);
                $("#imageBackUrl").val(data.staticFileName);

            } else {
                alert(result.msg);
            }
        }
    })
}  

function upload(){
    var fileId = "imgFile";
    var file = $("#" + fileId).val();
    var pos = file.lastIndexOf("\\");
    var fileName = file.substring(pos + 1);
    
    $.ajaxFileUpload({
        url : '@{back.webOperation.InformationMngCtrl.uploadInformationImage()}',
        secureuri : false,
        fileElementId : fileId,
        data:{
            "fileName":fileName
        },
        dataType : 'json',
        success : function(result) {
            if(result.code == 1){
                var data = result.obj;
                $("#image").attr("src", data.staticFileName);
                $("#imageUrl").val(data.staticFileName);

            } else {
                alert(result.msg);
            }
        }
    })
}

function checkNum(){
	var reg=/^[1-9]\d*$/;
	var voteNum = $("#voteNum").val();
	if(!reg.test(voteNum)){
		$("#voteNumError").html("此项必须为正整数");
		return false;
	}
	$("#voteNumError").html("");
	return true;
}
</script>
    