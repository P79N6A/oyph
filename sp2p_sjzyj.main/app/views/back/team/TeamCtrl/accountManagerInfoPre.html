#{extends 'common/back/teamMain.html' /}
	#{set title:'团队长 | 客户经理' /}
	#{set smallclass:0 /}
	#{set crumbs:'团队长 >客户经理'/}
	<div class="back-main">
	<!-- 头部筛选条件 -->
	<div class="back-usertop">
		<!-- 搜索按钮，控制搜索条件的显示隐藏 -->
		<div class="left back-usermenu">
		<a href="@{back.team.TeamCtrl.accountManagerListPre()}" >客户经理</a>
		<a href="@{back.team.TeamCtrl.accountManagerInfoPre()}"  class="selected"  >个人中心</a>
		</div>
		<!-- 右侧功能按钮 -->
	</div>
	
	    <div class="back-search-option" >
		<form action="@{back.team.TeamCtrl.accountManagerInfoPre()}" method="GET" id="showReleaseListPre">
			<input type="hidden" id="currPage" name="currPage"/>
	  		<input type="hidden" id="pageSize" name="pageSize" value="${pageBean?.pageSize}"/>
	  		<input type="hidden" id="exports" name="exports"/><!--是否导出  -->
			<input type="submit" class="bgbtn" value="搜索" />
		</form>
	</div>
	<div class="back-box back-divy clearfix">
            <div class="left">
                <p class="y-715p">个人资料</p>
    			<table class=" table-fixed" width="100%">
					<tbody><tr class="even" height="40">
					<td>
					职位： #{if team?.type==0}
					客户经理
					#{/if}
					#{if team?.type==1}
					业务主任
					#{/if}
					#{if team?.type==2}
					业务部经理
					#{/if}
					</td>
					<td>真实姓名：${team?.realName}</td>
					<td rowspan="3" style="width: 150px; height: 150px;">
					<img id="qrCodeImage" alt="" src="" style="width: 150px; height: 150px; display: none;" />
					<img id="codeBg" alt="" src="/public/front/images/code_bg.png" style="display: none;" />
					
						<div id="qrCode" style="display: none;">
							
						</div>
						<canvas id="extCode"></canvas>
						<input id="codeurl" type="hidden" class="code-url" value="@@{front.LoginAndRegisteCtrl.registerPre}?extensionCode=${codeSign}">
					</td>
					</tr>
						<tr height="50">
						<td> 手机号码：${supervisors?.mobile}</td>
					<td>推广码：${team?.code}</td>
					</tr>
                    <tr height="50">
                        <td colspan="2">推广链接：<input id="mytext" readonly="readonly" type="text" value="${extensionPath}" style="" /> &nbsp;
                        <input type="button" value="复制" class="btn" data-clipboard-text="${extensionPath}" style="width: 50px; height: 29px;" />
                            <div class="by-btn">
                   <!--  <a href="#" class="back-loginbtn bgbtn">编辑</a>
                    <a href="#" class="back-loginbtn bgbtn">保存</a> -->
                
                </div>
                        </td>
                    
                    </tr>
                    </tbody>
                </table>
            </div>
            <div class="left">
                    <p class="y-715p">个人资料 </p>
                        <table class=" table-fixed" width="100%">
            					<tbody><tr class="even" height="50">
            					<td>共推广会员人数：${team?.count}人</td>
                                <td>共理财会员人数：${team?.investCount}人</td>
                                <td></td>
            					</tr>
            					<tr height="50">
                                <td>共理财金额：${team?.total_money?.format("#0.00")}元</td>
            					<td>共赚取理财会员佣金：${team?.total_commission?.format("#0.00")}元</td>
            					</tr>
            					<tr class="even" height="50">
            					<td>
            					本月理财总金额:${team?.month_money?.format("#0.00")}元
            					</td>
            						<td>
            					本月赚取总佣金:${team?.deduct?.format("#0.00")}元
            					</td>
            					</tr>
            	</tbody></table>
            </div>
        </div>
        <div class="back-divy2">
            <div class=""></div>
                <div class="back-yasd clearfix">
                    <span class="bgbtn">我的团队</span>
                    <a class="back-loginbtn bgbtn" href="javascript:exportList(1)">导出</a>
                </div>
                <table class="back-table table-fixed" width="100%">
    				<tbody><tr class="even" height="40">
    					<th class="align-left" width="70">
    						<span class="back-order">
    							序号
    						</span>
    					</th>
    					<th>职位</th>
    					<th>
    						<span class="back-order">
    						    会员名
    						</span>
    					</th>
    					<th>真实姓名</th>
    					<th>推广时间</th>
    					<th>手机号码</th>
    					<th>本月理财金额</th>
    					<th>推广理财总金额</th>
    					<th width="140">操作</th>
    				</tr>
    				
    				#{if page?.page}
				#{list page?.page}
				<tr height="40">
					<td class="align-left">
						<label><input type="checkbox" class="back-tdcheck" />${_index}</label>
					</td>
							<td >
			推广会员
					</td>
					<td >
				${_?.name}
						</td>
						<td >
				${_?.realName}
					</td>
					<td>
					${_?.time?.format("yyyy-MM-dd")}
					</td>
					<td>
						${_?.mobile}
					</td>
					<td>
						${_?.monthAmount}
					</td>
						<td>
					${_?.investAmount}
					</td>
					<td>
				<a href="@{back.team.TeamCtrl.cpsDetailsPre(_?.id)}" >推广详情</a>	 
					</td>
				</tr>
				#{/list}
				<!-- 表格数据统计 -->
						<tr height="40">
						<td colspan="9" class="back-lasttd">
							<!-- 分页组件--pageTag -->
							#{backPageTag page:page,showPage:"showReleaseListPre"/}
						</td>
					</tr>
			#{/if}
    			#{else}	
					<!-- 暂无记录 -->
    					<tr height="58">
    						<td class="back-nodata" colspan="9"><i class="iconfont"></i>暂无记录</td>
    					</tr>
				</tbody>
			#{/else}
    				</table>
    		</div>
    	</div>
	
<!-- 页面js -->

<script type="text/javascript">

	require(["back"],function(back){
		// 搜索 排序 选中
		require(["search","linechecked"],function(){
		});
		require(["jquery.qrcode"],function(){
			showCode();	
			showCode();	
			var clipboard = new Clipboard('.btn'); 
			   clipboard.on('success', function(e) {
			        alert("复制成功！")
				    });
			   clipboard.on('error', function(e) {
				    alert("复制失败！请手动复制")
				 	});
		});
		
		
	});
	
	function release(bidNo) {
		confirm("编号"+bidNo+"，执行放款", function(){
			waitingDialog();
			$("#form_"+bidNo).submit();
		});
	}
	
	function showReleaseListPre(currPage, pageSize) {
		$("#currPage").val(currPage);
		$("#pageSize").val(pageSize);
		
		$("#showReleaseListPre").submit();
	}
	
	//导出
	function exportList(expor){
		$("#exports").val(expor);
		
		$("#showReleaseListPre").submit();
		$("#exports").val(0);
	}
	
	//排序
	function orderBy(orderType,orderValue){
		$("#showReleaseListPre input[name='orderType']").val(orderType);
		$("#showReleaseListPre input[name='orderValue']").val(orderValue);
		
		$("#showReleaseListPre input[name='currPage']").val(1);
		
		$("#showReleaseListPre").submit();
	}
	//二维码
	function showCode() {
		
		$("#qrCode").qrcode({render:"canvas", width:120, height:120, correctLevel:0, typeNumber:-1,background:"#ffffff",foreground:"#000000", text:$("#codeurl").val()});

		var cav = document.getElementsByTagName('canvas')[0];
		var ctx = cav.getContext('2d');
		
		var imgSrc = cav.toDataURL("image/img");  
	    var qrCodeImage = document.getElementById("qrCodeImage")
	    qrCodeImage.src = imgSrc;  
	   
	    var codeBg = document.getElementById("codeBg");
	    var extCode = document.getElementById("extCode");
	   
	 
	    extCode.width = 150;
	    extCode.height = 150;
	    var realcan =  extCode.getContext("2d");
	
	    preImage(qrCodeImage,function(){  
	    	realcan.drawImage(codeBg, 0, 0);
	    	realcan.drawImage(qrCodeImage, 15, 15);
	    });
	    
	}
	function preImage(imageO,callback){  
	     
	    if (imageO.complete) { // 如果图片已经存在于浏览器缓存，直接调用回调函数  
	         callback.call(imageO);  
	        return; // 直接返回，不用再处理onload事件  
	     }  
	  
	    imageO.onload = function () { //图片下载完毕时异步调用callback函数。  
	         callback.call(imageO);//将回调函数的this替换为Image对象  
	     };  
	}  
	
</script>
